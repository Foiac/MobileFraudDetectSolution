Comando CLI AZURE:


Encontrar assinatura atual: az account set --subscription "d194704a-1cc1-45e7-8cf5-2b4f7bb9e3c3"


---> Criar Grupo de Recursos:

subsId="d194704a-1cc1-45e7-8cf5-2b4f7bb9e3c3"
rgName="rgfraud"
region="eastus"
az group create --name $rgName --location $region

---> Provisionar Event Hub Namespace:

namespaceName="fraudEhNameSpace"
skuType="Basic"
az eventhubs namespace create --name $namespaceName --resource-group $rgName --sku $skuType -l $region

---> Provisionar T칩pico:

eventhubName="frauddetect"
az eventhubs eventhub create --resource-group $rgName --namespace-name $namespaceName --name $eventhubName --cleanup-policy Delete --partition-count 1

---> Criar Shared access policies para o eventhub

policieName="listenerEhPolicie"
az eventhubs namespace authorization-rule create --resource-group $rgName --namespace-name $namespaceName --name $policieName --rights Listen

---> Provisionar Azure Key Vault

kvName="kvfraud"
az keyvault create --name $kvName --resource-group $rgName --location $region

---> Transferir Connection String para uma vari치vel

connectionString=$(az eventhubs namespace authorization-rule keys list --resource-group $rgName --namespace-name $namespaceName --name $policieName --query primaryConnectionString --output tsv)

---> Alterar role de usu치rio para ter acesso ao key vault

az role assignment create --assignee kaio_cfs_hotmail.com#EXT#@kaiocfshotmail.onmicrosoft.com --role "Key Vault Administrator" --scope /subscriptions/$subsId/resourceGroups/$rgName/providers/Microsoft.KeyVault/vaults/$kvName

---> Armazenar Connection Strig no Key Vault

secretName="ehcssecret"
az keyvault secret set --vault-name $kvName --name $secretName --value $connectionString

---> Criar Scope no Databricks com secret criada

scopeName="dbwsscope"
kvName="kvfraud"
databricks secrets create-scope --scope $scopeName --scope-backend-type AZURE_KEYVAULT --resource-id $kvName --dns-name https://kvfraud.vault.azure.net

---> Instalar Coordinates Maven no databricks

com.microsoft.azure:azure-eventhubs-spark_2.12:2.3.22

---> Provisionar ADLS na azure:

storageAcName="stacfraud"
az storage account create --name $storageAcName --resource-group $rgName --location $region --sku Standard_LRS --kind StorageV2 --hierarchical-namespace true

---> Criar Container no ALDS:

containerName="contfraud"
az storage container create --name $containerName --account-name $storageAcName --auth-mode login

---> Criar os diret칩rios de armazenamento:

az storage fs directory create --account-name $storageAcName --file-system $containerName --name Bronze
az storage fs directory create --account-name $storageAcName --file-system $containerName --name Silver
az storage fs directory create --account-name $storageAcName --file-system $containerName --name Gold


---> Pegar chave de acesso do ADLS:

az storage account keys list --resource-group $rgName --account-name $storageAcName 




---> Provisionar Worksapce do Azure Databricks:

az databricks workspace create --resource-group $rgName --name databricks-fraudDetect --location $region --sku standard

---> Configs do Cluster Databricks:

Nome do cluster: fraud-cluster
Runtime: 13.3 LTS (Scala 2.12, spark 3.4.1)
Worker: Standard_D3_v2, 2 workers
Driver: Standard_D3_v2, 2 workers

---> Workflows:

Nome da tarefa: fraudFastLoad


---> Apagar Grupo de Recursos:

az group delete --name $rgName